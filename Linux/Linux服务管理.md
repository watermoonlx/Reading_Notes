# 1. 简介与分类

## 1.1 系统的运行级别

| 运行级别 | 含义                                                        |
| -------- | ----------------------------------------------------------- |
| 0        | 关机                                                        |
| 1        | 单用户模式。可以想象为windows的安全模式，主要用于系统修复。 |
| 2        | 不完全的命令行模式，不含NFS服务。                           |
| 3        | 完全命令行模式，就是标准字符界面                            |
| 4        | 系统保留                                                    |
| 5        | 图形模式                                                    |
| 6        | 重启动                                                      |

* `runlevel`：查看当前运行级别。
    * 通常情况下，显示两个字符：`N 3`。第一个字符代表前一个级别，后一个字符代表当前级别。`N`代表没有级别。即一开机就进入3级别。

* `init 级别`：修改运行级别。

* 修改系统默认运行级别：修改`/etc/inittab`文件，可控制系统开机后直接进入那个运行级别。
    * CentOS 7已不适用。

## 1.2 服务的分类

服务的分类：
* Linux服务
    * RPM包默认安装的服务
        * 独立的服务
        * 基于xinetd的服务（一种超级守护进程。它代理访问其他服务。优点：节约系统资源。目前已淘汰。）
    * 源码包安装的服务

PS：RPM包安装的服务和源码包安装的服务管理上有不同之处。但本质上并没有什么不同，都是Linux服务。可以通过一些配置让两者的管理方式一致。
主要是两者安装位置不同
* RPM包服务安装在默认位置。
* 源码包服务安装在指定位置，一般是`/usr/local/`。

服务启动与自启动：
* 服务启动：在当前系统中让服务运行。
* 服务自启动：让服务在系统开机或重启之后，随着系统的启动而自动启动。

查询已安装的服务：
* 查看RPM包安装的服务：`chkconfig --list`
    * 该命令查看RPM包安装的服务的自启动状态，因此也就可以看到所有RPM包安装的服务。展示的列表是在对应的运行级别下，服务是否自动启动。
* 查看源码包安装的服务：查看服务安装位置，一般是`usr/local/`下

> d是daemon的缩写，说明它自己是个守护进程(daemon) ，它在后台运行，一般都是用来做服务端程序。
mysqld代表是mysql数据库服务的守护进程。

## 1.3 服务与端口

查看系统中目前运行的服务，有两种方式：
* 使用`ps`命令。该命令列出当前运行的所有进程。要区分服务比较困难。
* 查看当前开启的端口。需要了解服务与端口的对应关系。（服务一定会绑定端口么？不一定吧。）

端口是什么？
* 如果把IP地址比作一间房子，端口就是进出这间房子的门。一个IP地址的端口最多有65536个（0-65525）。
* TCP和UDP各自独立，都有65536可以使用。只是有些端口号是公认的，比如80，就是TCP 80。为避免混淆，一般不会再分配给UDP 80。但也有一些服务会同时绑定TCP和UDP上的同一端口号，并提供相同服务，比如DNS。
* `/etc/services`文件列出了常见端口和服务的对应管理。

查看系统中开启的服务：
* `netstat -tulnp`
    * `-t`：列出tcp端口。只有TCP的状态会是Listen。因为需要建立连接。
    * `-u`：列出udp端口
    * `-l`：列出正在监听的网络服务（不包含已经连接的网络服务）
    * `-n`：用端口号显示服务，而不是服务名。
    * `-p`：列出该服务的进程ID（PID）。

# 2. RPM包服务管理

RPM包文件通常的默认安装位置：
* `/etc/`：配置文件位置
* `/etc/init.d/`：启动脚本位置（shell脚本）
    * 是`/etc/rc.d/init.d/`的软链接
* `/etc/sysconfig/`：初始化环境配置文件位置
* `/etc/xinetd.conf`：xinetd配置文件
* `/etc/xinetd.d/`：基于xinetd服务的启动脚本
* `/var/lib/`：服务产生的数据放在这里
* `/var/log/`：日志

启动服务的根本方式，和运行程序一样，是在shell中输入目标程序的绝对路径。

## 2.1 独立的服务管理

独立服务的启动：
* `/etc/init.d/独立服务名 start|stop|status|restart`：运行启动脚本。

* `service 独立服务名 start|stop|restart|status`：上面命令的快捷方式。

独立服务的自启动：
* `chkconfig [--level 运行级别] [独立服务名] [on|off]`
* 修改`/etc/rc.local`或`/etc/rc.d/rc.local`文件。该文件会在Linux启动之后、其余脚本都执行完成后执行。该方式与上面的命令独立，没有关系。不要同时使用。
* 使用`ntsysv`命令管理自启动。和第一种是同一种方法。
* `systemd`：centos 7推荐方式。

## 2.2. 基于xinetd服务的管理

# 3. 源码包服务管理

# 4. 服务管理总结