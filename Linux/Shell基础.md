[TOC]

# Shell基础

## 一、Shell概述

### 1.Shell是什么

Shell是一个命令行解释器。它为用户提供了一个向Linux内核发送请求以便运行程序的界面系统级程序。用户可以用Shell来启动、挂起、停止甚至编写一些程序。

Shell还是一个功能相当强大的编程语言，易编写，易调试，灵活性强。Shell是解释执行的脚本语言，在Shell中可以直接调用Linux系统命令。

### 2.Shell的分类

* Bourne Shell
  * sh，ksh，**Bash**（Linux中标准Shell），psh，zsh
* C Shell：C Shell主要在BSD版本的Unix系统中使用，其语法和C语言相似而得名。
  * csh，tcsh

> 查看当前运行的Shell：`echo $SHELL`

### 3.Linux支持的Shell

* /etc/shells。执行`vi /etc/shells `可查看当前所有可用shell。
* 可以在当前shell中，执行命令打开一个新的shell，比如`sh`。注意，此时原shell为父shell，新打开的shell为子shell。此时通过命令行界面，没办法区分当前是在父shell还是子shell中。（子shell还可以再打开自己的子shell）。此时执行`exit`可退出当前shell，回到父shell。注意，如果在“根”shell中执行exit，则退出登录。



## 二、脚本执行方式

### 1.echo输出命令

* `echo [选项] [输出内容]`
* 选项：
  * -e：支持反斜线控制的字符转换
    * 例：删除左侧字符：`echo -e "hell\bo"`
    * 例：制表符与换行符：`echo -e "h\te\tl\nl\to"`
    * 例：颜色：`echo  -e "\e[1;31m 啊哈 \e[0m"`。`\e[1;`开启颜色，`\e[0m`关闭颜色。

### 2.第一个脚本

* `vi hello.sh`

```sh
#!/bin/bash
#The first program

echo -e "\e[1;34m 天上掉下个林妹妹！\e[0m"
```

首行的`#!/bin/bash`指明了解释程序，表示这是一个shell脚本。

### 3.脚本执行

* 方法一：为文件赋予可执行权限，让它可以直接执行。
  * `chmod 755 hello.sh`
  * `./hello.sh`
* 方法二：通过Bash调用执行脚本。
  * `bash hello.sh`



## 三、Bash的基本功能

### 1.命令别名与快捷键

命令别名就像人的小名。

#### 查看、设定、删除别名

* `alias`：查看系统中所有的命令别名。
* `alias 别名='原命令'`：设定命令别名。这种方式设定的别名只对当前会话生效。一旦退出登录，则消失了。
* `unalias 别名`：只对当前会话生效。

#### 别名永久生效

* `vim ~/.bashrc`：写入环境变量配置文件。
  * `.bashrc`位于各个用户的家目录下。环境变量配置文件并不只这一个。
  * 需要重启后才生效。若想立即生效，需执行`source .bashrc`。

#### 命令生效顺序

当输入一个命令后，按照以下顺序查找匹配命令：

1. 用绝对路径或相对路径指定的命令。
2. 别名。
3. Bash的内部命令。
4. 按照$PATH环境变量定义的目录查找顺序找到的第一个命令。

#### bash常用快捷键

* `ctlr+c`：强制终止当前命令
* `ctrl+l`：清屏
* `ctrl+a`：关闭移动到命令行首
* `ctrl+e`：光标移动到命令行尾
* `ctrl+u`：从光标所在位置删除到行首
* `ctrl+z`：把命令放入后台
* `ctrl+r`：在历史命令中搜索



### 2.历史命令

#### 历史命令

* `history [选项] [历史命令保存文件]`
* 选项：
  * `-c`：清空历史命令。
  * `-w`：把缓存中的历史命令写入历史命令保存文件`~/.bash_history`。默认情况下，在注销时才保存。
* 历史命令默认保存1000条，可在环境变量配置文件`/etc/profile`中进行修改。（HISTSIZE字段）

#### 历史命令的调用（命令行）

* 使用上、下箭头调用以前的历史命令。
* 使用`!n`再次执行第n条历史命令。
* 使用`!!`再次执行上一条命令。
* 使用`!字符串`再次执行最后一次以该字符串开头的命令。

### 3.输入输出重定向

#### （1）标准输入输出

| 设备   | 设备文件名 | 文件描述 | 类型     |
| ------ | ---------- | -------- | -------- |
| 键盘   | /dev/stdin |  0        | 标准输入 |
| 显示器 | /dev/stdout | 1        | 标准输出          |
| 显示器  | /dev/stderr| 2         | 标准错误输出         |

#### （2）输出重定向

|类型|符号|作用 |
| ---- | ---- | ---- |
| 标准输出重定向 |   命令 `>` 文件 （注意有空格）   |以覆盖的方式，把命令的正确输出保存到指定的文件中|
|              | 命令 `>>` 文件 （注意有空格） |以追加的方式，把命令的正确输出保存到指定的文件中|
|标准错误输出重定向|错误命令 2`>`文件 （注意没有空格）      | 以覆盖的方式，把命令的错误输出保存到指定的文件中  |
|               |错误命令 2`>>`文件 （注意没有空格）      | 以追加的方式，把命令的错误输出保存到指定的文件中  |
|同时保持正确输出和错误输出|命令 `>` 文件 2`>>`&1      | 以覆盖的方式，把命令的正确输出和错误输出保存到指定的文件中 |
||命令 `>>` 文件 2`>>`&1 | 以追加的方式，把命令的正确输出和错误输出保存到指定的文件中 |
||命令 &>文件 | 以覆盖的方式，把命令的正确输出和错误输出保存到指定的文件中 |
||命令 &>>文件 | 以追加的方式，把命令的正确输出和错误输出保存到指定的文件中 |
||命令>>文件1 2>>文件2 | 以追加的方式，把命令的正确输出和错误输出保存到各自的文件中 |

重定向应理解为“把标准输出的内容重定向到指定文件”。如果不指定，标准输出默认显示到显示器。

命令 `>>` 文件a 2`>>`&1 ，这个命令好像等价于命令 `>>` 文件a 2`>>`文件a，但实际上不是。前者只会打开文件a一次。后者会打开文件a两次。错误输出将覆盖正确输出。

#### （3）输入重定向

##### 字数统计

* `wc [选项][文件名]`
* 选项：
  * `-c`：统计字节数
  * `-w`：统计单词数
  * `-l`：统计行数


##### 输入重定向
* `命令 < 文件名`
  * 例：`wc < file.log`
* `命令 << 起始标记`


### 4.管道符

### 多命令顺序执行执行符

| 执行符 | 格式             | 作用                                                         |
| ------ | ---------------- | ------------------------------------------------------------ |
| `;`    | 命令1 ; 命令2    | 多个命令顺序执行，命令直接没有任何逻辑联系。前一条命令的执行结果不影响后一条命令的执行。 |
| `&&`   | 命令1 && 命令2   | 逻辑与<br />当命令1正确执行后，命令2才执行。<br />当命令1执行不正确时，命令2不会执行。 |
| `||`   | 命令1 \|\| 命令2 | 逻辑或<br />当命令1执行不正确时，命令2才执行。<br />当命令1正确执行时，命令2不执行。 |

### 管道符

* `命令1 | 命令2`：命令1的正确输出作为命令2的操作对象。

例：`netstat -an | grep ESTABLISHED | wc -l`：统计当前链接人数。



### 5、Bash中的特殊符号

####（1）通配符

| 通配符 | 作用                                                   |
| ------ | ------------------------------------------------------ |
| ?      | 匹配一个任意字符。                                     |
| *      | 匹配0个或任意多个字符，即可以匹配任何内容。            |
| []     | 匹配中括号内任意一个字符。例如：[abc]代表匹配a或b或c。 |
| [-]    | 匹配中括号内任意一个字符。-代表一个范围。如[a-z]       |
| [^]    | 不匹配中括号内的任意一个字符。例如：\[^0-9]            |

#### （2）其他特殊符号

| 符号 | 作用                                                         |
| ---- | ------------------------------------------------------------ |
| ''   | 单引号。在单引号中的所有特殊符号，如“$”和"`"都没有特殊含义。原样输出。 |
| ""   | 双引号。在双引号中大部分特殊符号都没有特殊含义，但“$”、“\`”和“\”例外。“\$”代表“调用变量的值”。 "\`"代表引用命令。"\\"代表转义符。相当于“插值字符串” |
| \$() | 和反引号一样，用来引用系统命令。                             |
| #    | 在Shell脚本中，#开头的行代表注释。                           |
| \$   | 用于调用变量的值。比如，需要调用变量name的值时，需要用\$name的方式得到变量的值。 |
| \    | 转义符。                                                     |

变量：

```bash
aa=123

echo $aa # 输出为123

echo '$aa' # 单引号包裹，输出为$aa

echo "$aa" # 双引号包裹，输出为123。这个类似于JS中的插值字符串。
```

反引号\`：

```bash
aa=`ls` # 先让ls命令执行，然后将执行结果赋值给a。
```

容易看混，尽量用$()。