- [第2章 软件包管理简介](#第2章-软件包管理简介)
    - [2.1 软件包分类](#21-软件包分类)
- [第3章 rpm命令管理](#第3章-rpm命令管理)
    - [3.1 软件包管理简介](#31-软件包管理简介)
        - [（1）RPM包的来源](#1rpm包的来源)
        - [（2）RPM包的命名规则](#2rpm包的命名规则)
        - [（3）RPM包依赖性](#3rpm包依赖性)
        - [（4）包全名和包名](#4包全名和包名)
        - [（5）RPM包默认安装位置](#5rpm包默认安装位置)
    - [3.2 RPM命令管理](#32-rpm命令管理)
        - [（1）安装命令](#1安装命令)
        - [（2）升级与卸载](#2升级与卸载)
        - [（3）RPM包查询](#3rpm包查询)
        - [（4）RPM包校验](#4rpm包校验)
        - [（5）RPM包中文件提取](#5rpm包中文件提取)
    - [3.3 yun在线管理](#33-yun在线管理)
        - [（1）yum源（配置）文件](#1yum源配置文件)
        - [（2）光盘搭建yum源](#2光盘搭建yum源)
        - [（3）yum命令](#3yum命令)
            - [1.常用yum命令](#1常用yum命令)
                - [查询](#查询)
                - [安装](#安装)
                - [升级](#升级)
                - [卸载](#卸载)
            - [2.软件组管理命令](#2软件组管理命令)
    - [3.4 源码包管理](#34-源码包管理)
        - [（1）源码包和RPM包的区别](#1源码包和rpm包的区别)
        - [（2）源码包安装过程](#2源码包安装过程)
        - [（3）源码包的卸载](#3源码包的卸载)
    - [3.5 脚本安装包](#35-脚本安装包)
        - [例：LNMP(Nginx/MySQL/PHP)安装](#例lnmpnginxmysqlphp安装)

# 第2章 软件包管理简介

## 2.1 软件包分类

* 源码包。自己编译。
* 二进制包（不同发行版的Linux的二进制包不同。在redhat中，二进制包是RPM包（Red-Hat Package Manager））。包管理系统简单，只需要几个命令就可以实现包的安装、升级、查询和卸载。安装速度比源码包快得多。
  
* 脚本安装包。把复杂的软件包安装过程写成了程序脚本，初学者可以执行脚本实现一键安装。但实际安装的还是**源码包**和**二进制包**。


# 第3章 rpm命令管理

## 3.1 软件包管理简介

### （1）RPM包的来源

* RPM包在系统光盘中

### （2）RPM包的命名规则

`httpd-2.2.15-15.el6.centos.i686.rpm`
* `httpd`软件包名
* `2.2.15`软件版本
* `15`软件发布的次数
* `el6.centos`适合的Linux平台
* `i686`适合的硬件平台
* `rpm`扩展名

### （3）RPM包依赖性

* 树形依赖：a->b->c
* 环形依赖：a->b->c->a
* 模块依赖（库文件依赖）：查询网址：www.rpmfind.net

### （4）包全名和包名

* 包全名：操作的包是没有安装的软件包时，使用包全名。而且要注意路径。比如在安装、升级时。
* 包名：操作已经安装的软件包时，使用包名。是搜索/var/lib/rpm/中的数据库。比如在查询、卸载时。

### （5）RPM包默认安装位置

RPM包文件的默认安装位置是由RPM包作者指定的。通常符合以下规律：

| 目录              | 安装内容           |
| ----------------- | ------------------ |
| `/etc`            | 配置文件           |
| `/usr/bin/`       | 可执行的命令       |
| `/usr/lib/`       | 程序所使用的函数库 |
| `/usr/share/doc/` | 基本的软件使用手册 |
| `/usr/share/man/` | 帮助文件           |

但也可以自行指定安装位置。但建议不要自行指定。

## 3.2 RPM命令管理

### （1）安装命令

* `rpm -ivh 包全名`
    * `-i`：install，安装。
    * `-v`：verbose，显示详细信息。
    * `-h`：hash，显示进度。
    * `--nodeps`：不检查依赖性。

### （2）升级与卸载

* `rpm -Uvh 包全名`
    * `-U`：upgrade，升级。（若未安装，则安装。若安装了，则升级。）

* `rpm -e 包名`
    * `-e`：erase，卸载。
    * `--nodeps`：不检查依赖性。

### （3）RPM包查询

* `rpm -q 包名`：查询指定包是否已安装。
    * `-q`：query，查询。

* `rpm -qa`：查询所有已经安装的RPM包。

* `rpm -qi 包名`：查询软件包信息信息。
    * `-i`：查询软件信息。
    * `-p`：查询未安装包信息。需加上包全名。

* `rpm -ql 包名`：查询包中文件安装位置
    * `-l`：list，列表。
    * `-p`：查询未安装包信息。需加上包全名。

* `rpm -qf 文件名`：查询文件属于哪个RPM包。
    * `-f`：file。

* `rpm -qR 包名`：查询软件包的依赖性。即查询指定包依赖哪些包。
    * `-R`：requires。
    * `-p`：查询未安装包信息。需加上包全名。

### （4）RPM包校验

* `rpm -V 已安装的包名`：校验指定RPM包中的文件。
    * `-V`：Verify。

上述命令返回已被改变内容的"代表字符串"和文件类型（如果未修改，则没用返回）。
各字符对应的含义如下：

| 字符 | 改变的内容                    |
| ---- | ----------------------------- |
| S    | 文件大小                      |
| M    | 文件的类型或文件的权限（rwx） |
| 5    | 文件MD5校验和                 |
| D    | 设备的主从代码                |
| L    | 文件路径                      |
| U    | 文件的属主（所有者）          |
| G    | 文件的属组                    |
| T    | 文件的修改时间                |

文件类型字符含义如下：

| 字符 | 文件类型                                                |
| ---- | ------------------------------------------------------- |
| c    | 配置文件config file                                     |
| d    | 普通文件documentation                                   |
| g    | “幽灵”文件ghost file。即该文件不应该被这个RPM包包含。 |
| L    | 授权文件license file                                    |
| r    | 描述文件read me                                         |

### （5）RPM包中文件提取

* `rpm2cpio 包全名 | cpio -idv .要提取的文件绝对路径`
    * `rpm2cpio`：将rpm包转换为cpio格式的命令。
    * `cpio`：是一个标准工具，用于创建软件档案文件和从档案文件中提取文件。

## 3.3 yun在线管理

> 优点：自动解决依赖性问题。

### （1）yum源（配置）文件

* `/etc/yum.repos.d/CentOS-Base.repo`

| 字段       | 说明                                                                                                                                |
| ---------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| [base]     | 容器名称，一定要放在[]中。就是用来说明这个源的用途。                                                                                |
| name       | 容器说明。可以随便自己写。                                                                                                          |
| mirrorlist | 镜像站点                                                                                                                            |
| baseurl    | yum原服务器的地址。默认是CentOS官方的yum源服务器地址。可以改成自己想使用的。mirrorlist和baseurl有一个起效就可以，另一个可以注释掉。 |
| enabled    | 此容器是否生效。如果不写或写成enable=1都是生效。enable=0就是不生效。                                                                |
| gpgcheck   | 如果是1，指RPM的数字证书生效。如果是0则不生效。                                                                                     |
| gpgkey     | 数字证书的公钥文件保存位置。不用修改。                                                                                              |

### （2）光盘搭建yum源

1. 挂载光盘
* 建立挂载点：`mkdir /mnt/cdrom`
* 挂载：`mount /dev/sr0 /mnt/cdrom/`

2. 使网络yum源失效
* 进入yum源目录：`cd /etc/yum.repos.d/`
* 修改yum源文件后缀名，使其失效：`mv CentOS-Base.repo CentOS-Base.repo.bak`

3. 让光盘yum源生效。
* 修改`/etc/yum.repos.d/CentOS-Media.repo`文件，使其baseurl指向挂载目录。

### （3）yum命令

#### 1.常用yum命令

##### 查询

* `yum list`：查询所有可用软件包列表。
* `yum search 关键字`：搜索服务器上所有和关键字相关的包。

##### 安装

* `yum install -y 包名`。只需要包名，不需要包全名。
    * `install`：安装。
    * `-y`：自动回答yes。

##### 升级

* `yum update -y 包名`。只需要包名，不需要包全名。
    * `update`：升级。
    * `-y`：自动回答yes。

注意：
* `yum update -y`：将升级所有包，且升级软件和系统内核。有风险。
* `yum upgrade -y`：只升级所有包，不升级软件和系统内核。

##### 卸载

* `yum remove -y 包名`。

注意，尽量不要使用yum卸载。因为yum卸载会直接将相关依赖全部卸载了。

#### 2.软件组管理命令

* `yum grouplist`：列出所有可用的软件组列表

* `yum groupinstall 软件组名`：安装指定的软件组，组名可以由上一条命令查询。注意：软件组名必须是英文的。可在查询前使用命令`LANG=en_US`，将语言切换为英文再查询。然后通过`LANG=zh_CN.utf8`切换回来。

* `yum groupremove 软件组名`：卸载指定的软件组。

## 3.4 源码包管理

### （1）源码包和RPM包的区别

* 安装之前的区别：概念上的区别
* 安装之后的区别：安装位置不同

RPM包一般安装在由作者指定的默认位置，不手动指定。这样可以通过系统服务管理命令（`service`）来管理。例如RPM包安装的Apache的启动方法是：
* `/etc/rc.d/init.d/httpd start`：默认启动程序都在这个目录下。
* `service httpd start`：通过服务管理命令启动（默认搜索的就是上面的目录）。

源码包的安装位置必须手动指定。一般是`/usr/local/软件名/`。因此，源码包安装的服务不能被服务管理命令管理，因为没有安装到默认路径中。只能使用绝对路径进行服务管理，如：
* `/usr/local/apache2/bin/apachectl start`。

### （2）源码包安装过程

1.安装准备
* 安装C语言编译器（gcc）
* 下载源码包。
    * apache源码链接：http://mirror.bit.edu.cn/apache/httpd/#mirrors。

如何将本地window上的软件包传输到远程Linux上呢？使用`winscp`。
> WinSCP是一个Windows环境下使用SSH的开源图形化SFTP客户端。同时支持SCP协议。它的主要功能就是在本地与远程计算机间安全的复制文件。

2.安装注意事项
* 源代码（源码包）保存位置：`/usr/local/src/软件名/`
* 软件安装位置：`/usr/local/软件名/`
* 如何确定安装过程报错：
    * 安装过程停止，
    * 并出现error、warning或no的提示。

3.源码包安装过程（以apache举例）
* 下载源码包
* 解压缩下载的源码包
* 进入解压缩目录
* 执行`./configure`。即执行当前目录下的`configure`shell脚本。基本上每个源码包都有这个脚本。 `configure`作用：
    * 定义需要的功能选项。
    * 检测系统环境是否符合安装要求。
    * 把定义好的功能选项和检测系统环境的信息都写入`Makefile`文件，用于支持后续的make命令。
例：指定安装位置`./configure --prefix=/usr/local/apache2`

* `make`编译
    * 如果保存，执行`make clean`命令，清除所有编译后文件，以便重头再来。

* `make install`安装

* 启动apache服务：`/usr/local/apache2/bin/apachectl start`。
    * 如何知道启动程序的目录呢？可查看解压后目录下的`INSTALL`文件，里面说明了详细安装步骤。

* 测试是否启动成功：
    * 设置防火墙，打开80端口。参考：https://blog.csdn.net/weiyuefei/article/details/78899956。
        * `firewall-cmd --zone=public --add-port=80/tcp --permanent`
        * `firewall-cmd --reload`
    * 用浏览器访问linux主机IP地址

### （3）源码包的卸载
* 不需要卸载命令，直接删除安装目录即可。不会遗留任何垃圾文件。

## 3.5 脚本安装包

> 脚本安装包。把复杂的软件包安装过程写成了程序脚本，初学者可以执行脚本实现一键安装。但实际安装的还是**源码包**和**二进制包**。
> 优点：简单、快速、方便
> 缺点：
> * 不能定义安装软件的版本
> * 不能定义所需的软件功能

### 例：LNMP(Nginx/MySQL/PHP)安装

1.准备工作
* 关闭httpd和MySQL
* 保障yum源正常使用
* 关闭SELinux和防火墙
    * `vim /etc/selinux/config`，把SELINUX=enforcing修改为disabled。重启计算机。

2.安装步骤
* 下载lnmp脚本。https://lnmp.org/。
* 解压缩。`tar -zxvf lnmp1.0-full.tar.gz`。
* 进入解压目录。
* 执行安装脚本。`./centos.sh`