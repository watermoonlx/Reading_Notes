[TOC]

# 第1章 VIM文本编辑器

## VI编辑器的操作模式

* Command Mode - 命令模式。等待用户输入命令。比如撤销，剪切，复制，等等命令。
* Insert Mode - 输入模式。用于输入文本的模式
* Last Line Mode - 底行模式（尾行，末行）。可输入指令，比如对文件进行保存，退出，搜索字符串等操作。

例：

```bash
vim abc
```

如果存在abc文件，则直接打开。如果不存在，则先新建，再打开。

打开之后，vim默认处于命令模式。这个模式下，是不能向文件中输入文字的。vim此时等待用户输入命令，而非内容。

此时，输入命令`i`。vim进入输入模式（下方出现-- INSERT --字样）。此时便可以开始输入文本内容。

输入完成后，想要保存文本。则先点击`ESC`，回归命令模式。然后输入`:`，进入在底行模式。在底行模式下输入`wq`，敲回车，就可以保存并退出。

## VIM编辑器打开文件

`vim filename`：打开filename文件。若不存在，则新建。打开后光标默认位于第一行第一个字符处。（也不一定）

`vim + filename`：。。。。。。。。。。。打开后光标默认位于最后一行第一个字符处。

`vim +n filename`：。。。。。。。。。。。打开后光标默认位于第n行第一个字符处。

`vim +/pattern filename`：打开文件，同时定位到第一个匹配的行。（实验中发现定位不确定呢？）

`vim aa bb cc`：同时打开或创建多个文件。打开之后进入第一个文件。通过命令模式下输入`:n`，可切换到下一个文件。输入`:N`或`:prev`可切换到上一个文件。

## 常用指令

### 底行模式常用指令

* `:w`：保存修改。
* `:q`：退出。
* `:!`：强制执行。
* `:ls`：列出当前打开的所有文件。
* `:n`：切换到下一个文件。
* `:N`或`:prev`：切换到上一个文件。
* `:15`：将光标快速定位到第15行。
* `/xxx`：从当前光标位置开始，向后搜索匹配字符串。
*  `?xxx`：从当前光标位置开始，向前搜索匹配字符串。

### 命令模式常用指令

* h,j,k,i：左移移动
* ctrl+f：向下翻页
* ctrl+b：向上翻页
* ctrl+d：向下翻半页
* ctrl+u：向上翻半页
* dd：删除光标所在行
* o：在光标所在行的下方插入一行并切换到输入模式
* yy：复制光标所在行
* p：在光标所在行的下方粘贴
* P（大写）：在光标所在行的上方粘贴



# 第2章 磁盘管理

## 2-1 磁盘管理基本命令

### `df`：显示磁盘分区上可使用的磁盘空间

显示磁盘分区上可使用的磁盘空间。默认单位是KB。可以利用该命令来获取磁盘被占用了多少空间，目前还剩下多少空间等信息。

```bash
df [选项] [参数]
```

选项：

```
-a或--all：包含全部的文件系统；
--block-size=<区块大小>：以指定的区块大小来显示区块数目；
-h或--human-readable：以可读性较高的方式来显示信息；
-H或--si：与-h参数相同，但在计算时是以1000 Bytes为换算单位而非1024 Bytes；
-i或--inodes：显示inode的信息；
-k或--kilobytes：指定区块大小为1024字节；
-l或--local：仅显示本地端的文件系统；
-m或--megabytes：指定区块大小为1048576字节；
--no-sync：在取得磁盘使用信息前，不要执行sync指令，此为预设值；
-P或--portability：使用POSIX的输出格式；
--sync：在取得磁盘使用信息前，先执行sync指令；
-t<文件系统类型>或--type=<文件系统类型>：仅显示指定文件系统类型的磁盘信息；
-T或--print-type：显示文件系统的类型；
-x<文件系统类型>或--exclude-type=<文件系统类型>：不要显示指定文件系统类型的磁盘信息；
--help：显示帮助；
--version：显示版本信息。
```

### `du`：统计磁盘上的文件大小

**du命令**也是查看使用空间的，但是与[df](http://man.linuxde.net/df)命令不同的是Linux du命令是对文件和目录磁盘使用的空间的查看，还是和df命令有一些区别的。

```bash
du [选项] [文件]
```

选项：

```
-a或-all 显示目录中个别文件的大小。
-b或-bytes 显示目录或文件大小时，以byte为单位。
-c或--total 除了显示个别目录或文件的大小外，同时也显示所有目录或文件的总和。
-k或--kilobytes 以KB(1024bytes)为单位输出。
-m或--megabytes 以MB为单位输出。
-s或--summarize 仅显示总计，只列出最后加总的值。
-h或--human-readable 以K，M，G为单位，提高信息的可读性。
-x或--one-file-xystem 以一开始处理时的文件系统为准，若遇上其它不同的文件系统目录则略过。
-L<符号链接>或--dereference<符号链接> 显示选项中所指定符号链接的源文件大小。
-S或--separate-dirs 显示个别目录的大小时，并不含其子目录的大小。
-X<文件>或--exclude-from=<文件> 在<文件>指定目录或文件。
--exclude=<目录或文件> 略过指定的目录或文件。
-D或--dereference-args 显示指定符号链接的源文件大小。
-H或--si 与-h参数相同，但是K，M，G是以1000为换算单位。
-l或--count-links 重复计算硬件链接的文件。
```

## 2-2 硬盘分区和格式化

> 当硬盘空间消耗殆尽时怎么办？
>
> 答：在保留原硬盘的基础上，给服务器添加新的硬盘。

## 2-3 在VM虚拟机中添加硬盘

先关机，再添加。

## 2-4 MBR分区

Linux中硬件设备都是以文件的形式存在于根目录下的dev目录下。

Linux可自动识别硬件设备。硬盘添加到机器上后，可被Linux自动识别。但是此时还不能使用。必须对硬盘进行分区、格式化、挂载之后，才能使用。

分区命令：`fdisk`



## 2-5 GPT分区

### 磁盘分区与格式化

**分区模式之MBR**：

* 主分区加扩展分区不超过4个。扩展分区最多1个。
* 单个分区容量最大2TB。

**分区模式之GPT：**

* 主分区个数“几乎”没有限制。最多128个主分区。在此模式下不用怎么区分主分区和扩展分区了。
* 单个分区容量“几乎”没有限制。最多可达18EB。

缺点：GPT的主分区中，不适合安装x86架构的系统。

### GPT分区方法

`parted`命令：可以进行MBR分区(msdos)和GPT分区(gpt)。



## 2-6 分区格式化

`mkfs`命令：同时支持MBR和GPT分区。

MBR分区模式下，扩展分区无法格式化。只有主分区和逻辑分区可以格式化。



## 2-7 挂载

Linux提供的默认挂载目录：`/mnt`。

必须挂载到已经存在的挂载点（目录）。

挂载：`mount [分区] [挂载目录]`。

卸载：`umount [挂载目录]`

通过mount命令手动挂载分区不是永久的。当系统重启之后，挂载失效。

若希望系统启动时自动挂载，需要编辑`etc/fstab`配置文件。



## 2-8 swap分区

1.建立一个普通的Linux分区。主分区或逻辑分区。（参见上面步骤）

2.修改分区类型的16进制编码。

3.格式化交换分区。

4.启用交换分区。



# 第3章 用户管理

## 3-1 用户和用户组

* 用户：使用操作系统的人。
* 用户组：具有相同系统权限的一组用户。

用户和用户组信息保存在以下文件中：

* `/etc/group`：存储当前系统中所有用户组信息。

  * 每行格式：`Group :    x       :  123 : abc,def,xyz`

    ​		   `组名  : 组密码占位符 :组编号:组中用户名列表`

  * 当某个用户组内只有一个用户，且用户名和组名相同时，可以省略“用户名列表”。这就是为什么`/etc/group`文件中有很多组没有用户名列表。当然也可能真的没有用户。

  * root组编号一定为0。

  * 1-499是系统预留组编号。一般是预留给安装在操作系统中的软件和服务的。按照安装顺序依次分配。

  * 用户手动创建的组编号是从500开始的。

  * 组密码占位符全是x。

* `/etc/gshadow`：存储当前系统中用户组的密码信息。与`/etc/group`文件中的行一一对应。

  * 每行格式：`Group:  *    :        : abc,def,xyz`

    ​                   ` 组名 : 组密码 : 组管理者 : 组中用户列表`

  * 组密码为空或*或!，都可认为组密码为空，即没有密码。

* `/etc/passwd`：存储当前系统中所有用户的信息。

  * 每行格式：`用户名:密码站位符（x）:用户编号:用户组编号:用户注释信息:用户家目录:shell类型`

* `/etc/shadow`：存储当前系统中所有用户的密码信息。与`/etc/passwd`文件中行一一对应。

  * 每行格式：`用户名:密码（加密后的）::::`

## 3-2 Linux中用户和用户组的基本管理命令

`groupadd`

`groupmod`

`groupdel`

`useradd`

`usermod`

`userdel`

* 创建一个`/etc/nologin`文件，可以阻止处root用户以外的所有角色登录。

### 进阶命令

* 锁定用户：`passwd -l 用户名`
* 解锁用户：`passwd -u 用户名`
* 删除用户密码：`passwd -d 用户名`



## 3-3 主要组与附属组

* 用户可以同时属于多个组
  * 一个主要组
  * 多个附属组
* 修改主要用户组：`usermod -g`
* 将用户添加到一个附属组：`gpasswd -a 用户名 组名[,组名2，组名3]`
* 将用户从一个附属组中删除：`gpasswd -d 用户名 组名`
* 当用户属于多个用户组时，默认情况下，他创建的文件属于它的主要组。若想以附属组组员的身份创建一个文件，则需要用户自己执行`newgrp 组名 `。可能需要输入组密码。
* 创建用户时，同时指定主要组合附属组：
  * `useradd =g 主要组名 -G 附属组1[,附属组2，附属组3]`
* 修改组密码：
  * `gpasswd 组名称`
* 切换用户身份：
  * `su 用户名`。如果不加用户名，则代表切换到root用户。普通用户切换用户需要目标用户密码。root用户切换到其他用户则不需要密码。

### 其他命令

* `whoami`：显示当前登录用户名。
* `id 用户名`：显示指定用户信息。
* `groups 用户名`：显示用户所在的组。
* `chfn 用户名`：设置用户详细资料。
* `finger 用户名`：显示用户的详细资料。