[TOC]

# Logging

ASP.NET Core提供了logging API，支持多种logging provider。内置的provider允许你将日志发送到一个或多个目的地。你也可以使用第三方的日志框架。



## 如何创建logs

1.通过依赖注入获取ILogger服务。

2.调用该服务的各种Log方法。

例：

```csharp
public class TodoController : Controller
{
    private readonly ITodoRepository _todoRepository;
    private readonly ILogger _logger;

    public TodoController(ITodoRepository todoRepository,
        ILogger<TodoController> logger)
    {
        _todoRepository = todoRepository;
        _logger = logger;
    }
    
    public IActionResult GetById(string id)
    {
        _logger.LogInformation(LoggingEvents.GetItem, "Getting item {ID}", id);
        var item = _todoRepository.Find(id);
        if (item == null)
        {
            _logger.LogWarning(LoggingEvents.GetItemNotFound, "GetById({ID}) NOT FOUND", id);
            return NotFound();
        }
        return new ObjectResult(item);
    }
```

注意，上面是获取的ILogger<TodoController>服务，这将使用TodoController类作为Category。

​	**ASP.NET Core没有提供异步logger**。因为log操作应该是非常快速的，不值得使用异步。如果你的日志记录很慢，就应该考虑改变自己记日志的方式。比如先写入消息管道中，然后再记录到数据库中。



## 如何添加Provider

1.**什么是Provider**。Provider将获取通过ILogger对象记录的日志信息，然后做下一步处理，如展示（比如Console provider），或者记录到数据库。

2.**如何添加Provider**。调用Add<ProviderName>扩展方法。



## NuGet packages

The `ILogger` and `ILoggerFactory` interfaces are in [Microsoft.Extensions.Logging.Abstractions](https://www.nuget.org/packages/Microsoft.Extensions.Logging.Abstractions/), and default implementations for them are in [Microsoft.Extensions.Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging/).



## Log category

1.每条日志信息都包含一个category信息。该category信息是在创建Logger实例时指定的。

2.通常情况下，我们注入ILogger<T>服务，category就是T的类型的全名。如果想自己指定Category，则需要注入ILoggerFactory服务，然后手动创建Logger：

```c#
public TodoController(ITodoRepository todoRepository,
        ILoggerFactory logger)
    {
        _todoRepository = todoRepository;
        _logger = logger.CreateLogger("TodoApi.Controllers.TodoController");
    }
```



## Log level