# 第15章 REST API和JSON

## 15.1 JSON和XML

推荐使用JSON。



## 15.2 API设计

推荐：POST用于新建，PUT用于更新。



## 15.3 API错误报告

* 灾难性错误。导致服务器状态不稳定或不可知的错误。一般是未处理的异常导致的。从灾难性错误中恢复的唯一方法是重启服务器。理想情况下，所有挂起的请求应该收到响应码500。
* 可恢复的服务器错误。比如数据库链接不可用。问题可能是暂时的或永久的。此时应返回响应码500.
* 客户端错误。一般是请求的参数缺失或错误。推荐返回
  * 404：未找到
  * 400：错误的请求
  * 401：未授权



## 15.4 跨域资源共享CORS

由于同源策略的限制，与我们创建的API不处于一个域的应用程序（协议，域名，端口，三者决定一个域），将无法访问我们的API。

CORS可以解除这个限制。它是通过Acess-Control-Allow-Origin响应头实现的。

在Express中，最容易的方式，是使用cors包。

```javascript
app.use(require('cors')());//所有请求路径都启用CORS。

app.use('/api',(require('cors')());//只有以api开头的请求，才启用CORS。
```

以上只是服务器方面的设置。CORS还需要客户端（即浏览器）本身支持才行。

>
>CORS需要**浏览器和服务器同时支持**。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。
>整个CORS通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。**浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求**，但用户不会有感觉。
>因此，实现CORS通信的关键是服务器。只要服务器实现了CORS接口，就可以跨源通信。

## 15.5 数据存储

Mongo

## 15.6 测试

## 15.7 用Expres提供API

## 15.8 使用REST插件

模块：`connet-rest`



